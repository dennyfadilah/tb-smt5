<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>

<div class="row">
    <div class="col-xl-6 col-md-12">
        <div class="card">
            <div class="card-body">
                <div id="donutchart"></div>
            </div>
        </div>
    </div>

    <div class="col-xl-6 col-md-12">
        <div class="card">
            <div class="card-body">
                <div id="columnchart"></div>
            </div>
        </div>
    </div>
</div>


<?= $this->endSection() ?>

<?= $this->section('script') ?>

<script>
var chartHeight = 500;
var donutChart = null;
var columnChart = null;

$(document).ready(function() {
    getDonutChart();
    getColumnChart();
});

function getDonutChart() {
    //Lokasi yang sering disurvey
    // if(chart){
    //     chart.destroy();
    // }
    var options = {
        // series: [
        //     5, 4, 3,
        // ], //Bayak Survey
        // labels: [
        //     "Jakarta", "Bogor", "Depok",
        // ], //Lokasi

        plotOptions: {
            pie: {
                customScale: 1,
                // donut: {
                //     size: "0%"
                // }
            }
        },
        series: [
            <?php foreach ($list_lokasi as $lokasi) : ?>
            <?= intval($lokasi["kunjungan"]) ?>, //KOK GAK PERLU JSON_ENCODE ??!!
            <?php endforeach ?>
        ],
        labels: [
            <?php foreach ($list_lokasi as $lokasi) : ?>
            <?= json_encode($lokasi["lokasi"]) ?>,
            <?php endforeach ?>
        ],
        chart: {
            type: 'donut',
            height: chartHeight
        },
        responsive: [{
            breakpoint: 480,
            options: {
                chart: {
                    width: 200
                },
                legend: {
                    position: 'bottom'
                }
            }
        }]
    };

    donutChart = new ApexCharts(document.querySelector("#donutchart"), options);
    donutChart.render();
}

function getColumnChart() {
    var options = {
        series: [
            <?php foreach ($list_komoditas as $komoditas) : ?> { // IGNORE ERROR INI
                name: <?= json_encode($komoditas["komoditas"]) ?>,
                // komoditas
                data: [
                    <?php foreach ($list_lokasi as $lokasi) : ?>
                    //Lokasi
                    <?php foreach ($list_specific as $specific) : ?>
                    //jumlah
                    <?php if ($lokasi["lokasi"] == $specific["lokasi"] && $komoditas["komoditas"] == $specific["komoditas"]) : ?>
                    <?= intval($specific["jumlah"]) ?>,
                    <?php endif ?>
                    <?php endforeach ?>
                    <?php endforeach ?>
                ]
            },
            <?php endforeach ?>
        ],

        chart: {
            type: 'bar',
            height: chartHeight - 250
        },
        plotOptions: {
            bar: {
                horizontal: false,
                columnWidth: '50%',
                endingShape: 'rounded'
            },
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            show: true,
            width: 2,
            colors: ['transparent']
        },
        xaxis: {
            categories: [
                <?php foreach ($list_lokasi as $lokasi) : ?>
                <?= json_encode($lokasi["lokasi"]) ?>,
                <?php endforeach ?>
            ],
        },
        yaxis: {
            title: {
                text: 'Banyak Survey'
            }
        },
        fill: {
            opacity: 1
        },
        tooltip: {
            y: {
                formatter: function(val) {
                    return val + " kunjungan."
                }
            }
        }
    };

    columnChart = new ApexCharts(document.querySelector("#columnchart"), options);
    columnChart.render();
}
</script>

<?= $this->endSection() ?>